"use strict";var userID=TJY.getUrlParams("userId"),$renderDom=$("#goodsList"),goodsLoadEnd=!1,searchLoadEnd=!1,pageNo1=0,pageNo2=0,apiurl="/api/list/tao/product",itemIndex=0,keywords="";function requestType(type){if(0==type)pageNo1=0,goodsLoadEnd?(dropload.lock("down"),dropload.noData()):($(".searchList").hide(),$(".goodsList").show(),$(".iconfont1").hide(),itemIndex=0,dropload.unlock(),dropload.noData(!1));else if(1==type){if(""==(keywords=$.trim($(".goodsname").val())))return void showMask("请输入你想搜索的商品标题或关键词");pageNo2=0,$(".goodsList").hide(),$("#searchList").html(""),$(".searchList").show(),searchLoadEnd?(dropload.lock("down"),dropload.noData()):(itemIndex=1,dropload.unlock(),dropload.noData(!1))}dropload.resetload()}var dropload=$("#main").dropload({scrollArea:window,domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh"></div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},loadDownFn:function(me){if(0==itemIndex)pageNo1++,$renderDom=$("#goodsList"),apiurl="https://zhishun520.com/toutiaotv-api-home-1.0.0/professional/product/list",goods(me,{userId:1265,pageSize:10,pageNo:pageNo1,random:Math.random()});else if(1==itemIndex){pageNo2++;$(".goodsname").val();$renderDom=$("#searchList"),apiurl="https://zhishun520.com/toutiaotv-api-home-1.0.0/professional/product/search",goods(me,{userId:1265,pageSize:10,pageNo:pageNo2,cid:"",keyWord:keywords,random:Math.random()})}}});function goods(me,params){$.ajax({url:apiurl,type:"GET",dataType:"json",data:params,success:function(data){showData(me,data)},error:function(err){me.resetload()}})}function showData(me,data){var res=data.data,goodsType=["./img/type_taobaol_icon.png","./img/type_tmall_icon.png"],len=res.length,result="";0<len?(1==itemIndex&&$(".iconfont1").show(),res.map(function(item,index){var itemPrice=item.itemPrice,coupon=item.coupon,commission=item.commission,itemUrl=item.itemUrl,nativeUrl=item.nativeUrl,itemId=item.itemId,name=item.name,tmall=item.tmall,sales=item.sales,itemPicUrl=item.itemPicUrl,strParams=(item.id,jsonToUrlParams({userId:5946,itemId:itemId,coupon:coupon,goBack:!0,mall:tmall,commission:commission,itemUrl:itemUrl,nativeUrl:nativeUrl}));result+='<a href="http://www.miaokun520.com/rebatecr/goodsInfo.html?'+strParams+'">\n\t\t\t\t\t<dl class="goods-item">\n\t\t\t\t\t\t<dt><img class="lazyload" src="img/default.png" data-src="'+itemPicUrl+'_600x600q90.jpg" alt="图片加载失败"/></dt>\n\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t<div class="title" style="background-image:url('+goodsType[tmall]+')">'+name+'</div>\t\n\t\t\t\t\t\t\t<div class="dd2">\n\t\t\t\t\t\t\t\t<div class="coupon">'+coupon+'元券</div>\n\t\t\t\t\t\t\t\t<div class="rebate"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="dd3">\n\t\t\t\t\t\t\t\t<div class="dd3-wrap">\n\t\t\t\t\t\t\t\t\t<div class="price">￥'+(itemPrice-coupon).toFixed(2)+'元</div>\n\t\t\t\t\t\t\t\t\t<div class="itemPrice"><delete>￥'+itemPrice+'</delete></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="sales">已售'+numToSimple(sales)+"</div>\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</dd>\n\t\t\t\t\t</dl>\t\t\t\t\n\t\t\t\t</a>"})):(1!=pageNo1&&2!=pageNo1||($(".dropload-down").hide(),1==itemIndex&&(showMask("没有搜索到相关商品"),requestType(0))),0==itemIndex?goodsLoadEnd=!0:1==itemIndex&&(searchLoadEnd=!0),me.lock(),me.noData()),$renderDom.append(result),lazyload(),me.resetload()}function jsonToUrlParams(urlObj){var urlParamsString="";return Object.keys(urlObj).reduce(function(obj,key){urlParamsString+=key+"="+urlObj[key]+"&"},{}),urlParamsString}function numToSimple(number){return 1e4<number?(number/1e4).toFixed(1)+"w":number}function hideMask(){$(".mask").hide()}function showMask(text){$(".mask").show(),text&&$(".content").html(text)}$(window).scroll(function(){100<$(window).scrollTop()?$("#back-to-top").fadeIn(1500):$("#back-to-top").fadeOut(1500)}),$("#back-to-top").click(function(){return $("html").scrollTop()?$("html").animate({scrollTop:0},1e3):$("body").animate({scrollTop:0},1e3),!1});